<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Examen Completo</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .card { background: white; width: 100%; max-width: 700px; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        h1 { color: #2c3e50; font-size: 28px; margin-bottom: 10px; }
        h2 { color: #7f8c8d; font-size: 18px; font-weight: normal; margin-bottom: 30px; }
        
        /* Grid de botones para elegir tema */
        .grid-menu { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        
        .btn { padding: 15px; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; transition: 0.2s; font-weight: bold; color: white; width: 100%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn:active { transform: scale(0.98); }

        /* Colores por tema */
        .btn-theme { background-color: #34495e; }
        .btn-theme:hover { background-color: #2c3e50; }
        
        .btn-general { background-color: #e74c3c; grid-column: span 2; font-size: 1.3em; padding: 20px; }
        .btn-general:hover { background-color: #c0392b; }

        /* Estilos del examen */
        .progress { color: #7f8c8d; margin-bottom: 20px; font-size: 0.9em; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .question-box { font-size: 1.35em; font-weight: 600; color: #2c3e50; margin: 30px 0; line-height: 1.4; min-height: 80px; display: flex; align-items: center; justify-content: center; }
        
        input[type="text"] {
            width: 80%; padding: 15px; font-size: 1.2em; border: 2px solid #bdc3c7; border-radius: 8px; margin-bottom: 20px; outline: none; transition: 0.3s; text-align: center;
        }
        input[type="text"]:focus { border-color: #3498db; box-shadow: 0 0 8px rgba(52, 152, 219, 0.3); }

        .btn-action { background-color: #3498db; width: auto; padding: 15px 40px; }
        .btn-next { background-color: #2c3e50; display: none; width: auto; padding: 15px 40px; margin-top: 20px; }

        /* Feedback */
        .feedback { margin-top: 20px; padding: 20px; border-radius: 8px; display: none; text-align: left; }
        .feedback.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; text-align: center; }
        .feedback.wrong { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .correct-answer-text { font-weight: bold; margin-top: 5px; display: block; font-size: 1.1em; color: #c0392b; }

        .score-final { font-size: 4em; font-weight: 800; color: #2c3e50; margin: 10px 0; }
        .hidden { display: none; }
        
        .menu-btn { background-color: #95a5a6; margin-top: 10px; }
    </style>
</head>
<body>

<div class="card" id="start-screen">
    <h1>Simulador de Examen</h1>
    <h2>Elige quÃ© quieres practicar hoy:</h2>
    
    <div class="grid-menu">
        <button class="btn btn-theme" onclick="startExam('1')">Tema 1: Marketing</button>
        <button class="btn btn-theme" onclick="startExam('2')">Tema 2: Consumidor</button>
        <button class="btn btn-theme" onclick="startExam('3')">Tema 3: SegmentaciÃ³n</button>
        <button class="btn btn-theme" onclick="startExam('4')">Tema 4: Producto</button>
        <button class="btn btn-theme" onclick="startExam('5')">Tema 5: Precios</button>
        <button class="btn btn-theme" onclick="startExam('6')">Tema 6 y 7: Distrib./Com.</button>
        
        <button class="btn btn-general" onclick="startExam('all')">ðŸŽ² EXAMEN GENERAL (Aleatorio)</button>
    </div>
</div>

<div class="card hidden" id="quiz-screen">
    <div class="progress" id="progress-text">Pregunta 1 de 20</div>
    <div class="question-box" id="question-text">...</div>
    
    <input type="text" id="user-input" placeholder="Escribe tu respuesta..." autocomplete="off">
    
    <br>
    <button class="btn btn-action" id="btn-action" onclick="checkAnswer()">Comprobar</button>
    
    <div id="feedback-box" class="feedback">
        <span id="feedback-msg"></span>
        <span id="real-answer" class="correct-answer-text"></span>
    </div>

    <button class="btn btn-next" id="btn-next" onclick="nextQuestion()">Siguiente âž¡</button>
</div>

<div class="card hidden" id="result-screen">
    <h1>Resultados</h1>
    <div class="score-final" id="score-display">0 / 20</div>
    <p id="message-display"></p>
    <button class="btn btn-action" onclick="location.reload()">Volver al MenÃº</button>
</div>

<script>
    // BASE DE DATOS CON "TEMA" (t) ASIGNADO
    // t:1 (Tema 1), t:2 (Tema 2), etc.
    const database = [
        // TEMA 1: CONCEPTOS BÃSICOS
        {t: '1', q: "En la definiciÃ³n de Marketing, Â¿cuÃ¡l es la palabra clave?", a: "INTERCAMBIO"},
        {t: '1', q: "Â¿CÃ³mo definirÃ­a el Marketing como ACCIÃ“N?", a: "CONQUISTA DE MERCADOS"},
        {t: '1', q: "Â¿QuÃ© concepto es tratado en el Marketing como ilimitado?", a: "DESEOS"},
        {t: '1', q: "Llamar a clientes para medir calidad percibida es Marketing...", a: "MARKETING RELACIONAL"},
        {t: '1', q: "Â¿De quÃ© estÃ¡ compuesta la orientaciÃ³n al mercado?", a: "ORIENTACIÃ“N AL CONSUMIDOR MÃS ORIENTACIÃ“N A LA COMPETENCIA"},
        {t: '1', q: "Â¿El Marketing de relaciones es antes o despuÃ©s del intercambio?", a: "DESPUÃ‰S"},
        {t: '1', q: "Â¿Estrategia de Marketing relacionada con escaso Ã©nfasis en servicio al cliente?", a: "MARKETING TRANSACCIONAL"},
        {t: '1', q: "Estar en mÃ¡s puntos de venta que competidores y a menor precio es estrategia de:", a: "LIDERAZGO EN COSTES"},
        {t: '1', q: "A nivel de negocio, Â¿quÃ© tipo de estrategia de marketing se desarrolla?", a: "MARKETING ESTRATÃ‰GICO"},
        {t: '1', q: "En Marketing EstratÃ©gico, Â¿quÃ© funciÃ³n considera el concepto analizado ampliamente?", a: "DELIMITACIÃ“N DEL MERCADO RELEVANTE"},
        {t: '1', q: "El anÃ¡lisis de fortalezas y debilidades se realiza sobre:", a: "INTERNAMENTE A LA ORGANIZACIÃ“N Y A LA COMPETENCIA"},
        {t: '1', q: "Â¿La fijaciÃ³n de objetivos es antes o despuÃ©s de la estrategia?", a: "ANTES DE FÃ“RMULAR LA ESTRATEGIA"},
        {t: '1', q: "Â¿Las relaciones pÃºblicas y el poder a quÃ© tipo de marketing hacen referencia?", a: "MEGAMARKETING"},
        {t: '1', q: "Acuerdo con AdministraciÃ³n PÃºblica para reformar un parque es Marketing...", a: "MARKETING SOCIAL"},
        {t: '1', q: "Colaborar en lucha contra tabaco a cambio de licencia comercial es Marketing...", a: "MEGAMARKETING"},
        {t: '1', q: "Las alianzas estratÃ©gicas hacen referencia a la funciÃ³n de:", a: "MARKETING RELACIONAL"},
        {t: '1', q: "Â¿CuÃ¡les son las variables del marketing-mix?", a: "PRODUCTO, PRECIO, DISTRIBUCIÃ“N Y COMUNICACIÃ“N"},
        {t: '1', q: "Â¿CuÃ¡les son las variables del marketing operativo?", a: "PRODUCTO, PRECIO, DISTRIBUCIÃ“N Y COMUNICACIÃ“N"},
        {t: '1', q: "Conceptos vinculados al marketing como cultura:", a: "ORIENTACIÃ“N AL MERCADO Y MARKETING DE RELACIONES"},
        {t: '1', q: "Concepto mental sobre la posiciÃ³n de una marca en relaciÃ³n a otras:", a: "POSICIONAMIENTO COMPETITIVO"},

        // TEMA 2: COMPORTAMIENTO DEL CONSUMIDOR
        {t: '2', q: "Â¿QuÃ© teorÃ­a sobre el comportamiento de compra considera que los individuos compran los productos que maximizan su utilidad?", a: "ECONÃ“MICA"},
        {t: '2', q: "Â¿QuÃ© teorÃ­a sobre el comportamiento de compra se aplica preferentemente para el diseÃ±o de productos, envases y mensajes publicitarios?", a: "PSICOANALÃTICA"},
        {t: '2', q: "Â¿QuÃ© concepto de la teorÃ­a del aprendizaje se califica como positivo si la experiencia de compra ha sido satisfactoria?", a: "FORTALECIMIENTO"},
        {t: '2', q: "La forma en que el consumidor recoge, procesa e interpreta los estÃ­mulos sensoriales se denomina:", a: "PERCEPCIÃ“N"},
        {t: '2', q: "La predisposiciÃ³n general que dirige el comportamiento de compra de los individuos se denomina:", a: "MOTIVACIÃ“N"},
        {t: '2', q: "En el modelo de comportamiento de compra individual, Â¿la personalidad es una variable...?", a: "VARIABLE INTERNA"},
        {t: '2', q: "El estado afectivo del individuo ligado a su disposiciÃ³n a obrar de cierta forma ante algÃºn estÃ­mulo se denomina:", a: "ACTITUD"},
        {t: '2', q: "En el modelo de comportamiento de compra individual, Â¿la cultura es una variable...?", a: "VARIABLE EXTERNA"},
        {t: '2', q: "En el modelo de comportamiento de compra individual, Â¿el precio es una variable...?", a: "VARIABLE DE MARKETING"},
        {t: '2', q: "Los grupos de trabajo son:", a: "GRUPOS FORMALES PRIMARIOS"},
        {t: '2', q: "Â¿A quÃ© corresponde el rol del iniciador en la compra familiar?", a: "AL QUE INDICA LA NECESIDAD DE COMPRAR ALGO"},
        {t: '2', q: "Â¿CuÃ¡les son las diferencias de la compra industrial en relaciÃ³n a la individual?", a: "Ã‰NFASIS, COMPLEJIDAD Y TIPO DE RELACIÃ“N CLIENTE-VENDEDOR"},
        {t: '2', q: "Conjunto de personas que necesitan un producto, desean comprarlo y tienen capacidad para hacerlo:", a: "MERCADO"},
        {t: '2', q: "Â¿CÃ³mo se clasifican los grupos de interÃ©s en el modelo de agentes y fuerzas del entorno?", a: "MICROENTORNO"},
        {t: '2', q: "SegÃºn las caracterÃ­sticas de los compradores, los mercados se diferencian entre:", a: "MERCADO DE CONSUMO, INDUSTRIAL Y SERVICIOS"},
        {t: '2', q: "Â¿En quÃ© problema de los servicios se encuentra el no poder transmitir la propiedad de los mismos?", a: "INTANGIBILIDAD"},
        {t: '2', q: "Â¿En quÃ© problema de los servicios se emplea la mediciÃ³n de la satisfacciÃ³n de los clientes para evitarlo?", a: "HETEROGENEIDAD"},
        {t: '2', q: "Â¿La implicaciÃ³n del cliente en la producciÃ³n y la calidad final del servicio quÃ© problema origina?", a: "INSEPARABILIDAD"},
        {t: '2', q: "Â¿CÃ³mo se denomina el modelo de localizaciÃ³n que determina el lÃ­mite del Ã¡rea comercial?", a: "CONVERSE"},
        {t: '2', q: "Â¿QuiÃ©n formulÃ³ el modelo probabilÃ­stico de comportamiento espacial?", a: "HUFF"},

        // TEMA 3: SEGMENTACIÃ“N
        {t: '3', q: "Â¿QuÃ© dimensiÃ³n de la segmentaciÃ³n aplica tÃ©cnicas estadÃ­sticas para determinar grupos de clientes?", a: "ANALÃTICA"},
        {t: '3', q: "Si se detecta un nuevo segmento y la competencia no lo ha identificado, Â¿es siempre conveniente desarrollar una estrategia centrada en Ã©l?", a: "NO, DEPENDE"},
        {t: '3', q: "La macrosegmentaciÃ³n se equipara en las grandes corporaciones a las:", a: "UNIDADES ESTRATÃ‰GICAS DE NEGOCIO"},
        {t: '3', q: "Â¿En quÃ© consiste la metodologÃ­a de la segmentaciÃ³n a priori?", a: "DETERMINAR CON ANTERIORIDAD LOS SEGMENTOS Y LUEGO ANALIZARLOS"},
        {t: '3', q: "Â¿El posicionamiento competitivo es anterior o posterior al proceso de segmentaciÃ³n?", a: "POSTERIOR"},
        {t: '3', q: "Resultado de la fÃ³rmula C=|100-(180*180/330)| (Estudio de segmentaciÃ³n):", a: "1,81"},
        {t: '3', q: "Â¿Procedimiento de divisiÃ³n del mercado donde algunas personas pueden no clasificarse en ningÃºn grupo?", a: "TIPOLOGÃA"},
        {t: '3', q: "Â¿CÃ³mo se clasifica la dimensiÃ³n estilo de vida para la segmentaciÃ³n?", a: "GENERAL - SUBJETIVA"},
        {t: '3', q: "Volumen total, fÃ­sico o monetario adquirido por un grupo de compradores en lugar y periodo determinado:", a: "DEMANDA"},
        {t: '3', q: "Cifra de ventas que realiza el conjunto de empresas que opera en un determinado mercado:", a: "DEMANDA GLOBAL"},
        {t: '3', q: "RelaciÃ³n entre las ventas de una marca y las ventas totales del mercado:", a: "CUOTA DE MERCADO"},
        {t: '3', q: "Diferencia entre las ventas totales actuales y el mercado potencial absoluto:", a: "EXPANSIBILIDAD DE LA DEMANDA"},
        {t: '3', q: "Â¿Variables controlables por las empresas que influyen en la demanda?", a: "PRODUCTO, PRECIO, DISTRIBUCIÃ“N Y COMUNICACIÃ“N"},
        {t: '3', q: "Procedimiento de multiplicaciÃ³n de sucesivos porcentajes para estimar el mercado potencial:", a: "RATIOS EN CADENA"},
        {t: '3', q: "En el modelo de Markov, Â¿quÃ© probabilidades determinan el nivel de fidelidad?", a: "LAS DE LA DIAGONAL PRINCIPAL"},
        {t: '3', q: "Â¿CÃ³mo se calcula la situaciÃ³n de equilibrio en el modelo de Markov?", a: "HACIENDO LAS CUOTAS DE MERCADO CONSTANTES"},
        {t: '3', q: "Â¿QuÃ© mÃ©todo de previsiÃ³n de demanda se emplea para largo plazo?", a: "DELPHI"},
        {t: '3', q: "Si hay grandes fluctuaciones histÃ³ricas, Â¿quÃ© mÃ©todo a corto plazo NO se puede emplear?", a: "AJUSTE DE FUNCIONES"},
        {t: '3', q: "Â¿QuÃ© tipo de oscilaciÃ³n analiza el componente estacional?", a: "LAS DE UN PERÃODO INFERIOR AL AÃ‘O"},
        {t: '3', q: "Si hay un incremento significativo de demanda en los 2 Ãºltimos periodos, Â¿quÃ© mÃ©todo emplear?", a: "BANDA DE ALISADO 3 O COEFICIENTE TENDENTE A 1"},

        // TEMA 4: PRODUCTO
        {t: '4', q: "Â¿Una idea puede ser considerada como un producto en marketing?", a: "SÃ"},
        {t: '4', q: "Â¿Enfoque de marketing centrado en las caracterÃ­sticas de los productos?", a: "MIOPÃA DE MARKETING"},
        {t: '4', q: "En el concepto de producto de Kotler, la calidad es un aspecto:", a: "FORMAL"},
        {t: '4', q: "Â¿En quÃ© etapa del ciclo de vida se consigue el mÃ¡ximo beneficio?", a: "CRECIMIENTO"},
        {t: '4', q: "Â¿En quÃ© etapa del ciclo de vida se consiguen las mÃ¡ximas ventas?", a: "MADUREZ"},
        {t: '4', q: "Â¿En quÃ© etapa del ciclo de vida se encuentra la Wii (segÃºn el temario)?", a: "CRECIMIENTO"},
        {t: '4', q: "Â¿En quÃ© etapa se comienzan a reducir los mÃ¡rgenes comerciales?", a: "MADUREZ"},
        {t: '4', q: "Â¿CuÃ¡ndo es conveniente aplicar la estrategia de relanzamiento?", a: "MADUREZ"},
        {t: '4', q: "Conjunto de lÃ­neas de productos que comercializa una empresa:", a: "CARTERA DE PRODUCTOS"},
        {t: '4', q: "Estrategia de lanzar una nueva marca diferente con precio y calidad inferior:", a: "SEGUNDA MARCA"},
        {t: '4', q: "Grupo de productos estrechamente relacionados (mismas funciones, clientes, canales):", a: "LÃNEA DE PRODUCTOS"},
        {t: '4', q: "La amplitud de una cartera hace referencia al nÃºmero de:", a: "LÃNEAS DE PRODUCTOS"},
        {t: '4', q: "La profundidad de una cartera hace referencia al nÃºmero de:", a: "REFERENCIAS"},
        {t: '4', q: "Los componentes de una marca son:", a: "NOMBRE Y LOGOTIPO"},
        {t: '4', q: "Las marcas blancas son una estrategia de marca de:", a: "DISTRIBUIDOR"},
        {t: '4', q: "CaracterÃ­sticas de comunicador, diferenciador, promotor y protector hacen referencia al:", a: "ENVASE"},
        {t: '4', q: "Estrategia de resaltar caracterÃ­sticas para ser percibido como Ãºnico:", a: "DIFERENCIACIÃ“N"},
        {t: '4', q: "Forma, aspecto y color del producto que permite identificarlo:", a: "DISEÃ‘O"},
        {t: '4', q: "El cÃ³digo de barras es un elemento que se encuentra en:", a: "ETIQUETA"},
        {t: '4', q: "Â¿QuÃ© aspecto del producto hay que diseÃ±ar para reducir costes en logÃ­stica?", a: "ENVASE"},

        // TEMA 5: PRECIOS
        {t: '5', q: "Para el comprador el precio es el ______ que da a cambio de la utilidad.", a: "VALOR"},
        {t: '5', q: "Para la empresa el precio es un instrumento a ______ plazo.", a: "CORTO"},
        {t: '5', q: "Grupos de interÃ©s afectados por el precio (ademÃ¡s de clientes):", a: "PROVEEDORES, ACCIONISTAS, COMPETIDORES"},
        {t: '5', q: "MÃ©todo de fijar precios analizando otras marcas:", a: "COMPETENCIA"},
        {t: '5', q: "MÃ©todo de fijar precios que analiza a los consumidores:", a: "VALOR PERCIBIDO"},
        {t: '5', q: "MÃ©todo de fijar precios considerado objetivo y justo:", a: "BASADO EN EL COSTE"},
        {t: '5', q: "Â¿QuÃ© hay que determinar para fijar el precio objetivo?", a: "PUNTO MUERTO"},
        {t: '5', q: "Â¿FÃ³rmula del Punto Muerto (Ingresos y Costes)?", a: "IT = CT"},
        {t: '5', q: "Lanzar nuevo producto con precio muy competitivo para captar muchos clientes:", a: "PENETRACIÃ“N"},
        {t: '5', q: "Lanzar nuevo producto con gran innovaciÃ³n y precio elevado:", a: "DESCREMACIÃ“N"},
        {t: '5', q: "Si cargo 25% de margen sobre precio de venta, Â¿a quÃ© margen sobre coste equivale?", a: "33,33%"},
        {t: '5', q: "FÃ³rmula margen comercial sobre precio de coste:", a: "MC/PC"},
        {t: '5', q: "Caso PrÃ¡ctico: Costes 200k, Materias 100k, ProducciÃ³n 15.000 uds. Precio para ganar 10% sobre ventas:", a: "22,22 EUROS"},
        {t: '5', q: "Caso PrÃ¡ctico: Si 1.500 unidades NO se venden, Â¿precio de venta?", a: "24,69 EUROS"},
        {t: '5', q: "Caso PrÃ¡ctico: Â¿CuÃ¡l es el precio de punto muerto del caso anterior?", a: "20,00 EUROS"},
        {t: '5', q: "Caso PrÃ¡ctico: Â¿Cantidad a vender con el precio de 22,22â‚¬?", a: "13.500 UNIDADES"},
        {t: '5', q: "Caso PrÃ¡ctico: Si el valor percibido es 22â‚¬, Â¿aconseja vender las 15.000 uds?", a: "SI, SI ACEPTO MENOS BENEFICIOS"},
        {t: '5', q: "Caso PrÃ¡ctico: Si no se venden 1.500 uds, Â¿aconseja producciÃ³n?", a: "NO PORQUE EL PUNTO MUERTO ES 22,22 EUROS"},
        {t: '5', q: "Caso PrÃ¡ctico: Si competencia vende a 23â‚¬, Â¿cuÃ¡ndo aconseja vender?", a: "SI SE VENDEN LAS 15.000 UNIDADES"},
        {t: '5', q: "Estrategia de vender marca de gran volumen bajo coste para captar ventas en otros productos:", a: "LÃDER EN PÃ‰RDIDAS"},

        // TEMA 6 y 7: DISTRIBUCIÃ“N Y COMUNICACIÃ“N
        {t: '6', q: "Describa un canal de distribuciÃ³n directo:", a: "FABRICANTE - CONSUMIDOR FINAL"},
        {t: '6', q: "Describa un canal de distribuciÃ³n indirecto corto:", a: "FABRICANTE - MINORISTA - CONSUMIDOR FINAL"},
        {t: '6', q: "Describa un canal de distribuciÃ³n indirecto largo:", a: "FABRICANTE - MAYORISTA - MINORISTA - CONSUMIDOR FINAL"},
        {t: '6', q: "FunciÃ³n del canal donde se distribuyen cargas de stocks y pÃ©rdidas por caducidad:", a: "ASUNCIÃ“N DE RIESGOS"},
        {t: '6', q: "AcciÃ³n de ventas a intermediarios para que vendan la marca (Estrategia):", a: "PUSH - EMPUJAR"},
        {t: '6', q: "AcciÃ³n promocional a consumidores finales para que demanden la marca (Estrategia):", a: "PULL - ASPIRACIÃ“N"},
        {t: '6', q: "Promedio de veces que se llena y vacÃ­a de stocks un almacÃ©n:", a: "ROTACIÃ“N DE STOCKS"},
        {t: '6', q: "El tipo de servicio post-venta que requiere un producto determina:", a: "EL DISEÃ‘O DEL CANAL DE DISTRIBUCIÃ“N"},
        {t: '6', q: "Estrategia con nÃºmero limitado de puntos de venta:", a: "SELECTIVA"},
        {t: '6', q: "Estrategia de vender en el mayor nÃºmero de establecimientos posible:", a: "INTENSIVA"},
        {t: '6', q: "Acuerdo donde fabricante cede marca y comercializaciÃ³n en exclusiva:", a: "FRANQUICIA"},
        {t: '6', q: "Â¿Un intermediario mayorista le puede vender a otro mayorista?", a: "SÃ"},
        {t: '6', q: "Actividades del detallista para estimular compra en punto de venta:", a: "MERCHANDISING"},
        {t: '6', q: "Deformaciones en el proceso de comunicaciÃ³n en la comprensiÃ³n de mensajes:", a: "RUIDO"},
        {t: '6', q: "Â¿CuÃ¡l es el MIX de la comunicaciÃ³n?", a: "PUBLICIDAD, PROMOCIÃ“N DE VENTAS, FUERZA DE VENTAS, RELACIONES PÃšBLICAS Y MARKETING DIRECTO"},
        {t: '6', q: "Fines bÃ¡sicos de la comunicaciÃ³n:", a: "INFORMAR, PERSUADIR Y RECORDAR"},
        {t: '6', q: "Variable del mix de comunicaciÃ³n mÃ¡s impersonal:", a: "PUBLICIDAD"},
        {t: '6', q: "Variable del mix de comunicaciÃ³n mÃ¡s personal:", a: "LA FUERZA DE VENTAS"},
        {t: '6', q: "ComunicaciÃ³n directa, impersonal e interactiva por medios convencionales/tecnolÃ³gicos:", a: "MARKETING DIRECTO"},
        {t: '6', q: "Variable de comunicaciÃ³n donde NO se paga a los medios:", a: "RELACIONES PÃšBLICAS"}
    ];

    let currentQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let currentTopicName = "";

    // Evento ENTER en el input
    document.getElementById("user-input").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            if (document.getElementById("btn-action").style.display !== "none") {
                checkAnswer();
            } else {
                nextQuestion();
            }
        }
    });

    function startExam(topic) {
        let pool = [];
        
        // FILTRADO POR TEMA
        if (topic === 'all') {
            pool = [...database]; // Copia de todo
            currentTopicName = "EXAMEN GENERAL";
        } else {
            pool = database.filter(item => item.t === topic); // Filtra por el nÃºmero de tema
            currentTopicName = "TEMA " + topic;
            if(topic === '6') currentTopicName = "TEMAS 6 Y 7";
        }
        
        // ALEATORIEDAD: Barajar las preguntas
        let shuffled = pool.sort(() => 0.5 - Math.random());
        
        // SELECCIONAR MAX 20 (Si es un tema, son 20 justas, pero se barajan igual)
        currentQuestions = shuffled.slice(0, 20);
        
        currentIndex = 0;
        score = 0;
        
        // CAMBIO DE PANTALLA
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        
        loadQuestion();
    }

    function loadQuestion() {
        document.getElementById('progress-text').innerText = `${currentTopicName} | Pregunta ${currentIndex + 1} de ${currentQuestions.length}`;
        document.getElementById('question-text').innerText = currentQuestions[currentIndex].q;
        
        let input = document.getElementById('user-input');
        input.value = '';
        input.disabled = false;
        input.focus();
        
        // Reset visuales
        document.getElementById('feedback-box').style.display = 'none';
        document.getElementById('feedback-box').className = 'feedback';
        document.getElementById('btn-next').style.display = 'none';
        document.getElementById('btn-action').style.display = 'inline-block';
    }

    // FunciÃ³n de limpieza de texto (ignora mayÃºsculas, tildes y signos)
    function cleanString(str) {
        return str.toLowerCase()
                  .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
                  .replace(/[\.,-]/g, " ")
                  .replace(/\s+/g, ' ')
                  .trim();
    }

    function checkAnswer() {
        let userAnswer = document.getElementById('user-input').value;
        let correctAnswer = currentQuestions[currentIndex].a;

        let cleanUser = cleanString(userAnswer);
        let cleanCorrect = cleanString(correctAnswer);
        let isCorrect = false;

        // 1. Coincidencia exacta
        if (cleanUser === cleanCorrect) {
            isCorrect = true;
        } 
        // 2. Coincidencia parcial (solo si escribiste mÃ¡s de 3 letras)
        else if (cleanUser.length > 3 && cleanCorrect.includes(cleanUser)) {
             isCorrect = true;
        }

        let feedbackBox = document.getElementById('feedback-box');
        let feedbackMsg = document.getElementById('feedback-msg');
        let realAnswerMsg = document.getElementById('real-answer');

        if (isCorrect) {
            score++;
            feedbackBox.classList.add('correct');
            feedbackMsg.innerHTML = "<strong>Â¡CORRECTO!</strong>";
            realAnswerMsg.innerText = "";
        } else {
            feedbackBox.classList.add('wrong');
            feedbackMsg.innerHTML = "<strong>INCORRECTO</strong>";
            realAnswerMsg.innerHTML = "La respuesta correcta era:<br>" + correctAnswer;
        }

        feedbackBox.style.display = 'block';
        
        document.getElementById('user-input').disabled = true;
        document.getElementById('btn-action').style.display = 'none';
        document.getElementById('btn-next').style.display = 'inline-block';
        document.getElementById('btn-next').focus();
    }

    function nextQuestion() {
        currentIndex++;
        if (currentIndex < currentQuestions.length) {
            loadQuestion();
        } else {
            showResults();
        }
    }

    function showResults() {
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        
        let display = document.getElementById('score-display');
        let msg = document.getElementById('message-display');
        
        display.innerText = `${score} / ${currentQuestions.length}`;
        
        // Mensajes de Ã¡nimo segÃºn nota
        let percentage = (score / currentQuestions.length) * 10;
        
        if (percentage >= 9) {
            display.style.color = '#27ae60';
            msg.innerText = "Â¡IMPRESIONANTE! Nivel Experto.";
        } else if (percentage >= 5) {
            display.style.color = '#f39c12';
            msg.innerText = "Aprobado. Sigue practicando para asegurar el 10.";
        } else {
            display.style.color = '#c0392b';
            msg.innerText = "Sigue dÃ¡ndole caÃ±a. Â¡La prÃ³xima sale mejor!";
        }
    }
</script>

</body>
</html>